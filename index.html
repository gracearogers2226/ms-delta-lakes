<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mississippi Delta — Candidate Sampling Lakes</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Georgia', serif;
    background: #e9e4d6;
    color: #16312b;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  #header {
    background: #10342e;
    padding: 12px 20px;
    border-bottom: 2px solid #4aa3a0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
  }
  #header h1 {
    font-size: 16px;
    font-weight: bold;
    color: #d7f2f0;
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  #header p {
    font-size: 11px;
    color: #a7d8d5;
    margin-top: 3px;
  }
  #header-right {
    font-size: 10px;
    color: #a7d8d5;
    text-align: right;
    line-height: 1.6;
  }

  #main { display: flex; flex: 1; overflow: hidden; }

  /* SIDEBAR */
  #sidebar {
    position: relative;
    width: 260px;
    min-width: 260px;
    background: #10342e;
    border-right: 2px solid #2f6f6a;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: width 0.3s ease, min-width 0.3s ease;
  }
  #sidebar.collapsed { width: 0; min-width: 0; }

  #sidebar-inner {
    padding: 14px;
    overflow-y: auto;
    flex: 1;
  }
  #sidebar-inner::-webkit-scrollbar { width: 5px; }
  #sidebar-inner::-webkit-scrollbar-track { background: #10342e; }
  #sidebar-inner::-webkit-scrollbar-thumb { background: #4aa3a0; border-radius: 3px; }

  .sidebar-section { margin-bottom: 18px; }
  .sidebar-title {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: #a7d8d5;
    border-bottom: 1px solid #2f6f6a;
    padding-bottom: 5px;
    margin-bottom: 10px;
  }

  /* LEGEND */
  .legend-item {
    display: flex;
    align-items: center;
    margin-bottom: 7px;
    font-size: 12px;
    color: #d7f2f0;
  }
  .legend-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    margin-right: 9px;
    border: 2px solid rgba(255,255,255,0.3);
    flex-shrink: 0;
  }

  /* COUNTY TOGGLES */
  .county-toggle {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    cursor: pointer;
    font-size: 12px;
    color: #d7f2f0;
    user-select: none;
  }
  .county-toggle input {
    margin-right: 8px;
    cursor: pointer;
    accent-color: #4aa3a0;
    width: 14px;
    height: 14px;
  }
  .county-toggle:hover { color: #ffffff; }
  .county-count {
    margin-left: auto;
    background: #173f38;
    color: #a7d8d5;
    font-size: 10px;
    padding: 1px 6px;
    border-radius: 10px;
  }

  /* SELECT ALL */
  #select-all-btn {
    width: 100%;
    padding: 6px;
    background: #173f38;
    color: #d7f2f0;
    border: 1px solid #4aa3a0;
    border-radius: 4px;
    font-size: 11px;
    cursor: pointer;
    margin-bottom: 10px;
    letter-spacing: 0.5px;
  }
  #select-all-btn:hover { background: #4aa3a0; color: #0c2621; }

  /* STATS */
  .stat-row {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: #a7d8d5;
    margin-bottom: 5px;
    padding: 4px 6px;
    background: #173f38;
    border-radius: 3px;
  }
  .stat-val { color: #d7f2f0; font-weight: bold; }

  /* SIDEBAR TOGGLE BUTTON */
  #toggle-sidebar {
    position: absolute;
    right: -22px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2000;

    background: #11302a;
    border: 2px solid #4aa3a0;
    color: #d7f2f0;

    width: 22px;
    height: 56px;
    cursor: pointer;

    border-left: none;
    border-radius: 0 10px 10px 0;

    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #toggle-sidebar:hover { background: #1d5b52; color: #ffffff; }
  #sidebar.collapsed #toggle-sidebar {
    right: -22px;
    border-left: 2px solid #4aa3a0;
    border-right: none;
    border-radius: 10px 0 0 10px;
  }

  /* MAP */
  #map-container { position: relative; flex: 1; overflow: hidden; }
  #map { width: 100%; height: 100%; background: #efe6d2; }

  /* slight clarity boost without destroying colors */
  .basemap-tiles { filter: contrast(1.18) saturate(1.12) brightness(1.02); }

  /* FOOTER */
  #footer {
    background: #0c2621;
    border-top: 1px solid #2f6f6a;
    padding: 6px 16px;
    font-size: 10px;
    color: #a7d8d5;
    flex-shrink: 0;
    line-height: 1.6;
  }
  #footer span { color: #d7f2f0; }

  /* POPUP */
  .custom-popup .leaflet-popup-content-wrapper {
    background: #10342e;
    border: 1px solid #4aa3a0;
    border-radius: 6px;
    color: #d7f2f0;
    box-shadow: 0 4px 20px rgba(0,0,0,0.35);
    min-width: 240px;
  }
  .custom-popup .leaflet-popup-tip { background: #4aa3a0; }
  .custom-popup .leaflet-popup-content { margin: 12px 14px; font-family: 'Georgia', serif; }

  .popup-title { font-size: 14px; font-weight: bold; color: #d7f2f0; margin-bottom: 2px; }
  .popup-county {
    font-size: 10px;
    color: #a7d8d5;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid #2f6f6a;
  }
  .popup-badge {
    display: inline-block;
    font-size: 9px;
    padding: 2px 7px;
    border-radius: 10px;
    font-weight: bold;
    letter-spacing: 0.5px;
    margin-bottom: 10px;
    text-transform: uppercase;
  }
  .badge-natural { background: #1f5c5a; color: #d7f2f0; border: 1px solid #4aa3a0; }
  .badge-reservoir { background: #7a3f2f; color: #ffe6da; border: 1px solid #c06c4a; }

  .popup-row {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    margin-bottom: 5px;
    padding: 3px 0;
    border-bottom: 1px solid rgba(167,216,213,0.25);
  }
  .popup-label { color: #a7d8d5; }
  .popup-val { color: #d7f2f0; text-align: right; max-width: 60%; }

  .limited-data-banner {
    margin-top: 10px;
    padding: 5px 8px;
    background: #3a2f12;
    border: 1px solid #c9a84a;
    border-radius: 4px;
    font-size: 10px;
    color: #ffe9a8;
    text-align: center;
    letter-spacing: 0.5px;
  }
  .popup-coords {
    font-size: 10px;
    color: #a7d8d5;
    margin-top: 8px;
    text-align: center;
    font-style: italic;
  }
</style>
</head>

<body>

<div id="header">
  <div>
    <h1>Mississippi Delta — Candidate Sampling Lakes</h1>
    <p>Core Counties Only &nbsp;|&nbsp; ≥25 km from Nearest City &nbsp;|&nbsp; n=67 lakes</p>
  </div>
  <div id="header-right">
    Data Sources: USGS National Hydrography Dataset (NHD) &nbsp;|&nbsp; U.S. Census Bureau TIGER/Line 2020<br>
    Coordinates: WGS84 (EPSG:4326) &nbsp;|&nbsp; Distances: Haversine formula &nbsp;|&nbsp; Classification: NHD FType/FCode
  </div>
</div>

<div id="main">
  <div id="sidebar">
    <button id="toggle-sidebar" onclick="toggleSidebar()">&#9664;</button>

    <div id="sidebar-inner">
      <div class="sidebar-section">
        <div class="sidebar-title">Waterbody Class</div>
        <div class="legend-item"><div class="legend-dot" style="background:#2b7bbd"></div>Natural Lake</div>
        <div class="legend-item"><div class="legend-dot" style="background:#c06c4a"></div>Reservoir</div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Filter by County</div>
        <button id="select-all-btn" onclick="toggleAll()">Deselect All</button>
        <div id="county-checkboxes"></div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Visible Lakes</div>
        <div class="stat-row"><span>Showing</span><span class="stat-val" id="stat-showing">67</span></div>
        <div class="stat-row"><span>Natural Lakes</span><span class="stat-val" id="stat-natural">—</span></div>
        <div class="stat-row"><span>Reservoirs</span><span class="stat-val" id="stat-reservoir">—</span></div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Study Notes</div>
        <div style="font-size:10px; color:#a7d8d5; line-height:1.7;">
          Lakes included meet all criteria:<br>
          &bull; Named waterbody in USGS NHD<br>
          &bull; Area ≥ 4 ha (≥ 10 acres)<br>
          &bull; Located in core Delta county<br>
          &bull; ≥ 25 km from nearest Census-defined city (pop. ≥ 5,000)<br><br>
          <span style="color:#ffe9a8;">⚠ LIMITED DATA</span> flags lakes where one or more identifier fields are absent from source data.
        </div>
      </div>
    </div>
  </div>

  <div id="map-container">
    <div id="map"></div>
  </div>
</div>

<div id="footer">
  <span>Compilation & Map Design:</span> Grace A. Rogers — compiled and synthesized from sources below for Master’s Thesis research on Mississippi Delta Lakes.<br>
  <span>Sources:</span>
  U.S. Geological Survey (USGS). National Hydrography Dataset (NHD), Mississippi. Accessed 2025. https://www.usgs.gov/national-hydrography/national-hydrography-dataset &nbsp;|&nbsp;
  U.S. Census Bureau. TIGER/Line Shapefiles 2020: Mississippi Places and Counties. https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html &nbsp;|&nbsp;
  U.S. Census Bureau. 2020 Decennial Census: Population by Place, Mississippi. https://data.census.gov &nbsp;|&nbsp;
  Board on Geographic Names (BGN). Geographic Names Information System (GNIS). https://www.usgs.gov/tools/geographic-names-information-system-gnis<br>
  <span>County Boundaries:</span> U.S. county GeoJSON (FIPS) via Plotly datasets (filtered to Mississippi in-browser).
</div>

<script>
const LAKES = [{"name": "Bar Lake", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 31.8, "lat": 33.6749302094831, "lon": -91.06882769441742, "gnis_id": "74634.0", "nhd_id": "154112224", "nearest_city": "Greenville", "nearest_city_km": 32.3, "nearest_town": "Rosedale", "nearest_town_km": 20.0}, {"name": "Beulah Crevasse", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 96.5, "lat": 33.76044375773086, "lon": -91.03818166791407, "gnis_id": "667052.0", "nhd_id": "{7584F38F-3898-4100-B1EF-D3F921410E63}", "nearest_city": "Cleveland", "nearest_city_km": 28.7, "nearest_town": "Rosedale", "nearest_town_km": 10.3}, {"name": "Big Monocnoc Lake", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial (Unverified)", "area_acres": 22.4, "lat": 33.63811835271386, "lon": -91.09475401650069, "gnis_id": "667130.0", "nhd_id": "125450963", "nearest_city": "Greenville", "nearest_city_km": 28.4, "nearest_town": "Metcalfe", "nearest_town_km": 22.6}, {"name": "Brushy Lake", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 32.5, "lat": 33.62117024137867, "lon": -91.03852869935884, "gnis_id": "667703.0", "nhd_id": "125450979", "nearest_city": "Greenville", "nearest_city_km": 26.3, "nearest_town": "Metcalfe", "nearest_town_km": 19.3}, {"name": "Conservation League Lake", "county": "Bolivar County", "class": "Reservoir", "permanence": "Unknown", "area_acres": 37.1, "lat": 33.87150633585935, "lon": -90.952683720066, "gnis_id": "668772.0", "nhd_id": "125621806", "nearest_city": "Cleveland", "nearest_city_km": 25.1, "nearest_town": "Rosedale", "nearest_town_km": 7.8}, {"name": "Lake Beulah", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 980.2, "lat": 33.7713268768118, "lon": -91.01438241313706, "gnis_id": "75642.0", "nhd_id": "7E0347BC-2E19-44D2-9271-0E27EDE32C8B", "nearest_city": "Cleveland", "nearest_city_km": 26.6, "nearest_town": "Rosedale", "nearest_town_km": 9.2}, {"name": "Lake Bolivar", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 701.6, "lat": 33.6143411899108, "lon": -91.068654015077, "gnis_id": "667410.0", "nhd_id": "125450991", "nearest_city": "Greenville", "nearest_city_km": 25.6, "nearest_town": "Metcalfe", "nearest_town_km": 19.2}, {"name": "Lake Concordia", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 16.1, "lat": 33.933772419866635, "lon": -90.99158709062756, "gnis_id": "668757.0", "nhd_id": "52117545", "nearest_city": "Cleveland", "nearest_city_km": 32.2, "nearest_town": "Rosedale", "nearest_town_km": 9.8}, {"name": "Lake Vermilon", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 44.7, "lat": 33.72677616904507, "lon": -91.02475497322597, "gnis_id": "679204.0", "nhd_id": "154112044", "nearest_city": "Cleveland", "nearest_city_km": 27.5, "nearest_town": "Rosedale", "nearest_town_km": 14.0}, {"name": "Lake Whittington", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 3329.0, "lat": 33.67743451594541, "lon": -91.0905352359407, "gnis_id": "75221.0", "nhd_id": "154112128", "nearest_city": "Greenville", "nearest_city_km": 32.7, "nearest_town": "Rosedale", "nearest_town_km": 20.2}, {"name": "Legion Lake", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 32.6, "lat": 33.81731296656229, "lon": -91.00343672873532, "gnis_id": "672395.0", "nhd_id": "52117727", "nearest_city": "Cleveland", "nearest_city_km": 26.7, "nearest_town": "Rosedale", "nearest_town_km": 4.8}, {"name": "Long Hole", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 11.9, "lat": 33.74196384932227, "lon": -91.03060379363204, "gnis_id": "672827.0", "nhd_id": "154112040", "nearest_city": "Cleveland", "nearest_city_km": 27.9, "nearest_town": "Rosedale", "nearest_town_km": 12.3}, {"name": "Long Lake", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 22.4, "lat": 33.79937814538009, "lon": -91.01737298225048, "gnis_id": "75769.0", "nhd_id": "52117769", "nearest_city": "Cleveland", "nearest_city_km": 27.4, "nearest_town": "Rosedale", "nearest_town_km": 6.1}, {"name": "Old River Lake", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 326.9, "lat": 33.96588523454745, "lon": -90.98498090410718, "gnis_id": "75058.0", "nhd_id": "52117393", "nearest_city": "Cleveland", "nearest_city_km": 34.2, "nearest_town": "Rosedale", "nearest_town_km": 13.4}, {"name": "Porter Lake", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 48.3, "lat": 33.946703105720694, "lon": -90.86984839371736, "gnis_id": "676257.0", "nhd_id": "125621448", "nearest_city": "Cleveland", "nearest_city_km": 26.1, "nearest_town": "Shelby", "nearest_town_km": 9.7}, {"name": "Stamps Lake", "county": "Bolivar County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 18.5, "lat": 33.974698033439296, "lon": -90.88720963232234, "gnis_id": "678212.0", "nhd_id": "125621092", "nearest_city": "Cleveland", "nearest_city_km": 29.5, "nearest_town": "Shelby", "nearest_town_km": 11.6}, {"name": "Chute Lake", "county": "Coahoma County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 50.7, "lat": 34.43902594413053, "lon": -90.52678115880148, "gnis_id": "668489.0", "nhd_id": "123561726", "nearest_city": "Clarksdale", "nearest_city_km": 27.6, "nearest_town": "Friars Point", "nearest_town_km": 12.9}, {"name": "Desoto Lake (South)", "county": "Coahoma County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 1037.9, "lat": 34.146188763687604, "lon": -90.84726950475633, "gnis_id": "65615.0", "nhd_id": "49917229-18C2-4833-A76C-46666B471E54", "nearest_city": "Clarksdale", "nearest_city_km": 26.1, "nearest_town": "Shelby", "nearest_town_km": 23.0}, {"name": "Gunhouse Chute", "county": "Coahoma County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 19.4, "lat": 34.45026389827703, "lon": -90.53822374580068, "gnis_id": "689271.0", "nhd_id": "123561696", "nearest_city": "Clarksdale", "nearest_city_km": 28.7, "nearest_town": "Friars Point", "nearest_town_km": 12.9}, {"name": "Haynes Lake", "county": "Coahoma County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 14.9, "lat": 34.40469986557211, "lon": -90.46643985144912, "gnis_id": "671028.0", "nhd_id": "123561810", "nearest_city": "Clarksdale", "nearest_city_km": 25.3, "nearest_town": "Jonestown", "nearest_town_km": 9.3}, {"name": "Moon Lake", "county": "Coahoma County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 2510.7, "lat": 34.423225714536656, "lon": -90.52023868481729, "gnis_id": "673765.0", "nhd_id": "123561819", "nearest_city": "Clarksdale", "nearest_city_km": 26.0, "nearest_town": "Friars Point", "nearest_town_km": 12.4}, {"name": "Blue Hole", "county": "Issaquena County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 79.6, "lat": 32.94723472757891, "lon": -91.06790000222816, "gnis_id": "667294.0", "nhd_id": "{a7f48556-9cf2-4022-88fb-1bf05597465e}", "nearest_city": "Greenville", "nearest_city_km": 48.7, "nearest_town": "Rolling Fork", "nearest_town_km": 18.4}, {"name": "Carlisle Lake", "county": "Issaquena County", "class": "Natural Lake", "permanence": "Perennial (Unverified)", "area_acres": 11.1, "lat": 32.83581451275705, "lon": -91.07783604646932, "gnis_id": "668061.0", "nhd_id": "125452071", "nearest_city": "Vicksburg", "nearest_city_km": 60.4, "nearest_town": "Rolling Fork", "nearest_town_km": 20.4}, {"name": "Cypress Lake", "county": "Issaquena County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 195.0, "lat": 32.61196839419693, "lon": -90.90750376877496, "gnis_id": "669065.0", "nhd_id": "125452378", "nearest_city": "Vicksburg", "nearest_city_km": 32.8, "nearest_town": "Rolling Fork", "nearest_town_km": 33.0}, {"name": "Fitler Lake", "county": "Issaquena County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 128.6, "lat": 32.73701054598262, "lon": -91.0472650002185, "gnis_id": "670002.0", "nhd_id": "154113716", "nearest_city": "Vicksburg", "nearest_city_km": 49.1, "nearest_town": "Rolling Fork", "nearest_town_km": 24.7}, {"name": "Fivemile Lake", "county": "Issaquena County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 116.2, "lat": 32.66844398560944, "lon": -91.02503582272745, "gnis_id": "670010.0", "nhd_id": "125452258", "nearest_city": "Vicksburg", "nearest_city_km": 41.2, "nearest_town": "Rolling Fork", "nearest_town_km": 29.9}, {"name": "Goose Lake (Central)", "county": "Issaquena County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 30.2, "lat": 32.656066013743654, "lon": -91.0091955666507, "gnis_id": "670519.0", "nhd_id": "125452304", "nearest_city": "Vicksburg", "nearest_city_km": 39.4, "nearest_town": "Rolling Fork", "nearest_town_km": 30.5}, {"name": "Goose Lake (North)", "county": "Issaquena County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 20.4, "lat": 32.78435629061848, "lon": -91.04074423758291, "gnis_id": "670520.0", "nhd_id": "125452156", "nearest_city": "Vicksburg", "nearest_city_km": 53.9, "nearest_town": "Rolling Fork", "nearest_town_km": 20.5}, {"name": "Greasy Lake", "county": "Issaquena County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 101.0, "lat": 32.58291666272462, "lon": -90.76409628306082, "gnis_id": "693347.0", "nhd_id": "123835524", "nearest_city": "Vicksburg", "nearest_city_km": 31.7, "nearest_town": "Edwards", "nearest_town_km": 31.6}, {"name": "Valley Park Lake", "county": "Issaquena County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 100.3, "lat": 32.63165931818056, "lon": -90.85718548765269, "gnis_id": "695067.0", "nhd_id": "{dde517a4-1635-427d-b5eb-087e99d77af6}", "nearest_city": "Vicksburg", "nearest_city_km": 35.1, "nearest_town": "Rolling Fork", "nearest_town_km": 30.7}, {"name": "Algar Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 25.7, "lat": 34.16441556274781, "lon": -90.23204629088974, "gnis_id": "666193.0", "nhd_id": "{cbd79f02-ecd8-4257-b1bb-6c7eda11a4dd}", "nearest_city": "Clarksdale", "nearest_city_km": 31.2, "nearest_town": "Lambert", "nearest_town_km": 6.3}, {"name": "Bear Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 38.7, "lat": 34.30751913628026, "lon": -90.30609394878408, "gnis_id": "666657.0", "nhd_id": "123561925", "nearest_city": "Clarksdale", "nearest_city_km": 27.3, "nearest_town": "Marks", "nearest_town_km": 6.8}, {"name": "Blue Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 12.8, "lat": 34.13093928364158, "lon": -90.20853300244028, "gnis_id": "667310.0", "nhd_id": "{993a44f5-98de-4924-af96-2a629c916477}", "nearest_city": "Batesville", "nearest_city_km": 33.1, "nearest_town": "Crowder", "nearest_town_km": 8.0}, {"name": "Boyce Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial (Unverified)", "area_acres": 14.7, "lat": 34.075889521743875, "lon": -90.24084211196872, "gnis_id": "667488.0", "nhd_id": "{7F9DDB84-0B0A-45EF-B5EE-DA0C2B2DEF00}", "nearest_city": "Clarksdale", "nearest_city_km": 32.9, "nearest_town": "Crowder", "nearest_town_km": 14.4}, {"name": "Croudip Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 21.8, "lat": 34.1202990037454, "lon": -90.20143134387544, "gnis_id": "668986.0", "nhd_id": "124184412", "nearest_city": "Batesville", "nearest_city_km": 33.4, "nearest_town": "Crowder", "nearest_town_km": 8.3}, {"name": "Grassy Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 10.0, "lat": 34.413936612093224, "lon": -90.38433848054176, "gnis_id": "670605.0", "nhd_id": "123561784", "nearest_city": "Clarksdale", "nearest_city_km": 29.9, "nearest_town": "Jonestown", "nearest_town_km": 12.1}, {"name": "Horseshoe Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 13.9, "lat": 34.09110192729926, "lon": -90.19463408203218, "gnis_id": "671500.0", "nhd_id": "124185068", "nearest_city": "Batesville", "nearest_city_km": 35.1, "nearest_town": "Crowder", "nearest_town_km": 10.5}, {"name": "Island Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 28.0, "lat": 34.15244696091617, "lon": -90.23361303235428, "gnis_id": "671729.0", "nhd_id": "124183957", "nearest_city": "Clarksdale", "nearest_city_km": 31.2, "nearest_town": "Lambert", "nearest_town_km": 7.1}, {"name": "Little Whiting Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 19.9, "lat": 34.27947908286331, "lon": -90.3038573906038, "gnis_id": "672709.0", "nhd_id": "123561949", "nearest_city": "Clarksdale", "nearest_city_km": 26.2, "nearest_town": "Marks", "nearest_town_km": 4.1}, {"name": "Long Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 22.5, "lat": 34.4077209626109, "lon": -90.38101349663488, "gnis_id": "672840.0", "nhd_id": "123561793", "nearest_city": "Clarksdale", "nearest_city_km": 29.5, "nearest_town": "Jonestown", "nearest_town_km": 11.7}, {"name": "Oxbow Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 30.5, "lat": 34.074940932193606, "lon": -90.1982821858586, "gnis_id": "675359.0", "nhd_id": "124185492", "nearest_city": "Clarksdale", "nearest_city_km": 36.6, "nearest_town": "Crowder", "nearest_town_km": 12.2}, {"name": "Twin Lakes", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 22.3, "lat": 34.169994362517215, "lon": -90.22086975005516, "gnis_id": "679004.0", "nhd_id": "124183842", "nearest_city": "Batesville", "nearest_city_km": 31.6, "nearest_town": "Lambert", "nearest_town_km": 6.8}, {"name": "Willow Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 21.5, "lat": 34.13656638366365, "lon": -90.22503713599367, "gnis_id": "679739.0", "nhd_id": "124184091", "nearest_city": "Clarksdale", "nearest_city_km": 32.3, "nearest_town": "Lambert", "nearest_town_km": 9.0}, {"name": "Wilson Lake", "county": "Quitman County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 22.8, "lat": 34.30886689688072, "lon": -90.29834802307708, "gnis_id": "679771.0", "nhd_id": "123561922", "nearest_city": "Clarksdale", "nearest_city_km": 28.0, "nearest_town": "Marks", "nearest_town_km": 6.6}, {"name": "Beaverdam Lake", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 464.3, "lat": 34.62587963083559, "lon": -90.40375522282956, "gnis_id": "666735.0", "nhd_id": "123559543", "nearest_city": "Senatobia", "nearest_city_km": 39.2, "nearest_town": "Tunica", "nearest_town_km": 7.2}, {"name": "Duck Lake", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 90.4, "lat": 34.6004736080095, "lon": -90.54417718183836, "gnis_id": "669473.0", "nhd_id": "52116293", "nearest_city": "Clarksdale", "nearest_city_km": 45.3, "nearest_town": "Tunica", "nearest_town_km": 17.8}, {"name": "Fish Lake (North)", "county": "Tunica County", "class": "Reservoir", "permanence": "Unknown", "area_acres": 11.3, "lat": 34.65052141721734, "lon": -90.26399907744776, "gnis_id": "669983.0", "nhd_id": "123558616", "nearest_city": "Senatobia", "nearest_city_km": 26.7, "nearest_town": "Tunica", "nearest_town_km": 11.5}, {"name": "Fish Lake (South)", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 21.7, "lat": 34.490094452452425, "lon": -90.30806086145756, "gnis_id": "669981.0", "nhd_id": "123561424", "nearest_city": "Senatobia", "nearest_city_km": 33.1, "nearest_town": "Crenshaw", "nearest_town_km": 10.5}, {"name": "Fish Lake Bayou", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 12.1, "lat": 34.8344986997796, "lon": -90.33860907748574, "gnis_id": "669989.0", "nhd_id": "2016E86C-A5DE-455F-9F4B-EA5B932BD711", "nearest_city": "Horn Lake", "nearest_city_km": 29.3, "nearest_town": "Tunica", "nearest_town_km": 16.7}, {"name": "Flower Lake", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 395.8, "lat": 34.60199425479748, "lon": -90.50988368318411, "gnis_id": "670050.0", "nhd_id": "52116289", "nearest_city": "Clarksdale", "nearest_city_km": 45.8, "nearest_town": "Tunica", "nearest_town_km": 15.2}, {"name": "Lake Tyranza", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 12.4, "lat": 34.56101193093144, "lon": -90.28118212796328, "gnis_id": "679018.0", "nhd_id": "123560504", "nearest_city": "Senatobia", "nearest_city_km": 28.4, "nearest_town": "Crenshaw", "nearest_town_km": 10.1}, {"name": "Mud Lake (Central)", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 17.3, "lat": 34.61833532083727, "lon": -90.57153800830596, "gnis_id": "684861.0", "nhd_id": "52116271", "nearest_city": "Clarksdale", "nearest_city_km": 47.3, "nearest_town": "Tunica", "nearest_town_km": 19.1}, {"name": "Mud Lake (North)", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 14.8, "lat": 34.702868235766616, "lon": -90.34235892944216, "gnis_id": "674444.0", "nhd_id": "123557384", "nearest_city": "Senatobia", "nearest_city_km": 35.1, "nearest_town": "Tunica", "nearest_town_km": 3.9}, {"name": "Mud Lake (South)", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 28.9, "lat": 34.60330801698856, "lon": -90.53659430098904, "gnis_id": "674443.0", "nhd_id": "52116299", "nearest_city": "Clarksdale", "nearest_city_km": 45.7, "nearest_town": "Tunica", "nearest_town_km": 17.1}, {"name": "North Lake", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 27.2, "lat": 34.60583075747923, "lon": -90.53036280619004, "gnis_id": "674951.0", "nhd_id": "{C7DB95B0-0292-4B31-941F-FFDE773555BC}", "nearest_city": "Clarksdale", "nearest_city_km": 46.0, "nearest_town": "Tunica", "nearest_town_km": 16.4}, {"name": "O K Pocket", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 94.4, "lat": 34.62282054974249, "lon": -90.50639916015058, "gnis_id": "684863.0", "nhd_id": "5983B125-C4BE-48C2-8626-450ACE55E9D1", "nearest_city": "Clarksdale", "nearest_city_km": 48.1, "nearest_town": "Tunica", "nearest_town_km": 13.6}, {"name": "Old River Chute", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 156.4, "lat": 34.5542296466582, "lon": -90.52371460906753, "gnis_id": "684865.0", "nhd_id": "52116341", "nearest_city": "Clarksdale", "nearest_city_km": 40.4, "nearest_town": "Tunica", "nearest_town_km": 19.8}, {"name": "Old River Lake", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 35.1, "lat": 34.845386675864326, "lon": -90.3175846210614, "gnis_id": "675238.0", "nhd_id": "52115581", "nearest_city": "Horn Lake", "nearest_city_km": 27.1, "nearest_town": "Walls", "nearest_town_km": 16.9}, {"name": "Sandy Bayou", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 70.2, "lat": 34.6063022343886, "lon": -90.48343078651928, "gnis_id": "684869.0", "nhd_id": "1344D403-AEB0-4963-8FF4-A9B5406F3F52", "nearest_city": "Senatobia", "nearest_city_km": 46.4, "nearest_town": "Tunica", "nearest_town_km": 13.1}, {"name": "Trout Lake", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 23.1, "lat": 34.56394616138384, "lon": -90.30377886075549, "gnis_id": "684876.0", "nhd_id": "123560408", "nearest_city": "Senatobia", "nearest_city_km": 30.4, "nearest_town": "Crenshaw", "nearest_town_km": 12.0}, {"name": "Tunica Lake", "county": "Tunica County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 3662.7, "lat": 34.65907837692971, "lon": -90.50809307546018, "gnis_id": "690133.0", "nhd_id": "52116237", "nearest_city": "Senatobia", "nearest_city_km": 49.0, "nearest_town": "Tunica", "nearest_town_km": 12.1}, {"name": "Brushy Lake", "county": "Washington County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 12.6, "lat": 33.16867994394524, "lon": -90.93804807862976, "gnis_id": "667702.0", "nhd_id": "125451619", "nearest_city": "Greenville", "nearest_city_km": 26.3, "nearest_town": "Hollandale", "nearest_town_km": 8.0}, {"name": "Byrne Lake", "county": "Washington County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 18.5, "lat": 33.10401036806307, "lon": -91.0959828968018, "gnis_id": "667893.0", "nhd_id": "125451741", "nearest_city": "Greenville", "nearest_city_km": 31.5, "nearest_town": "Hollandale", "nearest_town_km": 24.0}, {"name": "Deer Lake", "county": "Washington County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 78.4, "lat": 33.083653060409176, "lon": -90.98981556952612, "gnis_id": "669200.0", "nhd_id": "125451751", "nearest_city": "Greenville", "nearest_city_km": 34.0, "nearest_town": "Hollandale", "nearest_town_km": 16.4}, {"name": "Lake Britton", "county": "Washington County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 54.3, "lat": 33.071375328949635, "lon": -91.10476679174272, "gnis_id": "667581.0", "nhd_id": "125451760", "nearest_city": "Greenville", "nearest_city_km": 35.2, "nearest_town": "Hollandale", "nearest_town_km": 26.2}, {"name": "Lake Jackson", "county": "Washington County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 201.8, "lat": 33.052310925745154, "lon": -91.09734120846544, "gnis_id": "671790.0", "nhd_id": "125451779", "nearest_city": "Greenville", "nearest_city_km": 37.2, "nearest_town": "Rolling Fork", "nearest_town_km": 26.1}, {"name": "Lake Washington", "county": "Washington County", "class": "Natural Lake", "permanence": "Perennial", "area_acres": 3063.9, "lat": 33.06606077049104, "lon": -91.04668769051794, "gnis_id": "679361.0", "nhd_id": "125451784", "nearest_city": "Greenville", "nearest_city_km": 35.5, "nearest_town": "Hollandale", "nearest_town_km": 21.8}];
const CORE_FIPS = ["28011", "28027", "28055", "28119", "28125", "28133", "28143", "28151"];

const COLOR = {
  'Natural Lake': '#2b7bbd',
  'Reservoir':    '#c06c4a'
};

// Count by county
const countyCounts = {};
LAKES.forEach(l => {
  countyCounts[l.county] = (countyCounts[l.county] || 0) + 1;
});
const countyOrder = Object.keys(countyCounts).sort();

// Map init
const map = L.map('map', {
  center: [33.8, -90.7],
  zoom: 8,
  zoomControl: true
});

// Basemap: CARTO Voyager (clearer roads, blue water, green parks/landmarks)
L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
  maxZoom: 19,
  className: 'basemap-tiles'
}).addTo(map);

// COUNTY SHADING + OUTLINES
async function addCountyLayer() {
  try {
    const url = 'https://raw.githubusercontent.com/plotly/datasets/master/geojson-counties-fips.json';
    const resp = await fetch(url);
    const usCounties = await resp.json();

    // Mississippi counties have FIPS starting with "28"
    const msFeatures = usCounties.features.filter(f => String(f.id).startsWith('28'));
    const msGeo = { type: "FeatureCollection", features: msFeatures };

    function styleCounty(feature) {
      const fips = String(feature.id);
      const isCore = CORE_FIPS.includes(fips);

      return {
        fillColor: isCore ? '#6fa3d8' : '#a8c6e8',
        fillOpacity: isCore ? 0.22 : 0.12,
        color: isCore ? '#2a4f73' : '#5a7d9a',
        weight: isCore ? 2.0 : 1.0,
        opacity: isCore ? 0.95 : 0.70
      };
    }

    L.geoJSON(msGeo, {
      style: styleCounty,
      interactive: false
    }).addTo(map);

  } catch (e) {
    console.warn('County layer failed to load:', e);
  }
}
addCountyLayer();

// MARKERS
const allMarkers = [];

LAKES.forEach(lake => {
  const color = COLOR[lake.class] || '#777';

  const icon = L.divIcon({
    className: '',
    html: `<div style="
      width:14px; height:14px; border-radius:50%;
      background:${color};
      border:2px solid rgba(20,20,20,0.70);
      box-shadow:0 0 8px rgba(0,0,0,0.35);
    "></div>`,
    iconSize: [14, 14],
    iconAnchor: [7, 7],
    popupAnchor: [0, -10]
  });

  const gnisBad = (!lake.gnis_id || lake.gnis_id === 'N/A' || String(lake.gnis_id).toLowerCase() === 'nan');
  const nhdBad  = (!lake.nhd_id  || lake.nhd_id  === 'N/A' || String(lake.nhd_id).toLowerCase() === 'nan');
  const limited = gnisBad || nhdBad;

  const badgeClass = (lake.class === 'Reservoir') ? 'badge-reservoir' : 'badge-natural';

  const popupHtml = `
    <div class="popup-title">${lake.name}</div>
    <div class="popup-county">${lake.county}</div>
    <div><span class="popup-badge ${badgeClass}">${lake.class}</span></div>
    <div class="popup-row"><span class="popup-label">Hydrologic Permanence</span><span class="popup-val">${lake.permanence}</span></div>
    <div class="popup-row"><span class="popup-label">Area</span><span class="popup-val">${lake.area_acres.toLocaleString()} acres</span></div>
    <div class="popup-row"><span class="popup-label">Nearest City</span><span class="popup-val">${lake.nearest_city} (${lake.nearest_city_km} km)</span></div>
    <div class="popup-row"><span class="popup-label">Nearest Town</span><span class="popup-val">${lake.nearest_town} (${lake.nearest_town_km} km)</span></div>
    <div class="popup-row"><span class="popup-label">GNIS ID</span><span class="popup-val">${lake.gnis_id}</span></div>
    <div class="popup-row"><span class="popup-label">NHD Permanent ID</span><span class="popup-val" style="font-size:10px">${lake.nhd_id}</span></div>
    ${limited ? '<div class="limited-data-banner">⚠ LIMITED DATA — One or more identifier fields absent from source</div>' : ''}
    <div class="popup-coords">${lake.lat.toFixed(5)}, ${lake.lon.toFixed(5)}</div>
  `;

  const marker = L.marker([lake.lat, lake.lon], {icon})
    .bindPopup(popupHtml, {className: 'custom-popup', maxWidth: 280});

  allMarkers.push({ marker: marker, county: lake.county, class: lake.class });
  marker.addTo(map);
});

// SIDEBAR CHECKBOXES
const container = document.getElementById('county-checkboxes');
countyOrder.forEach(county => {
  const shortName = county.replace(' County', '');
  const div = document.createElement('div');
  div.className = 'county-toggle';
  div.innerHTML = `
    <input type="checkbox" id="chk-${shortName}" checked onchange="filterMarkers()">
    <label for="chk-${shortName}" style="cursor:pointer">${shortName}</label>
    <span class="county-count">${countyCounts[county]}</span>
  `;
  container.appendChild(div);
});

function filterMarkers() {
  const active = {};
  countyOrder.forEach(county => {
    const short = county.replace(' County', '');
    const chk = document.getElementById('chk-' + short);
    active[county] = chk ? chk.checked : true;
  });

  let showing = 0, natural = 0, reservoir = 0;

  allMarkers.forEach(obj => {
    const marker = obj.marker;
    const county = obj.county;
    const cls = obj.class;

    if (active[county]) {
      marker.addTo(map);
      showing++;
      if (cls === 'Natural Lake') natural++;
      else if (cls === 'Reservoir') reservoir++;
    } else {
      map.removeLayer(marker);
    }
  });

  document.getElementById('stat-showing').textContent = showing;
  document.getElementById('stat-natural').textContent = natural;
  document.getElementById('stat-reservoir').textContent = reservoir;
}
filterMarkers();

let allSelected = true;
function toggleAll() {
  allSelected = !allSelected;
  countyOrder.forEach(county => {
    const short = county.replace(' County', '');
    const chk = document.getElementById('chk-' + short);
    if (chk) chk.checked = allSelected;
  });
  document.getElementById('select-all-btn').textContent = allSelected ? 'Deselect All' : 'Select All';
  filterMarkers();
}

// Sidebar toggle
let sidebarOpen = true;
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const btn = document.getElementById('toggle-sidebar');

  sidebarOpen = !sidebarOpen;

  if (sidebarOpen) {
    sidebar.classList.remove('collapsed');
    btn.innerHTML = '&#9664;';
  } else {
    sidebar.classList.add('collapsed');
    btn.innerHTML = '&#9654;';
  }

  setTimeout(() => map.invalidateSize(), 310);
}
</script>

</body>
</html>
